#!/bin/sh

if [ -z $MOUNT_ROOT ]; then
	echo "No MOUNT_ROOT defined!"  >&2
	exit 1
fi

home_fixed=`readlink -f $HOME`

for argument in $*; do
  file=`echo $argument | cut -f1 -d:`
  line=`echo $argument | grep -o ':[^:]*$' | cut -c2-`
  relative_name=`readlink -f $file | sed 's_'$home_fixed'__'  | sed 's,/var/groupon/aviv/,,' `
  FILE_ARG="&file=$relative_name"
  LINE_ARG=
  if [ -n "$line" ]; then
    LINE_ARG="&line=$line"
  fi
  sensible-browser "editor://open/?root=$MOUNT_ROOT$FILE_ARG$LINE_ARG"
done
